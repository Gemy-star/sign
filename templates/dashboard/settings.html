{% extends 'base.html' %}
{% load static %}

{% block title %}الإعدادات{% endblock %}

{% block extra_css %}
<style>
    .settings-container {
        padding: 30px;
    }

    .settings-header {
        margin-bottom: 30px;
    }

    .settings-header h1 {
        font-size: 28px;
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
    }

    .settings-header p {
        color: #666;
        font-size: 14px;
    }

    .settings-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .settings-card h2 {
        font-size: 20px;
        font-weight: 600;
        color: #667eea;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #f5f5f5;
    }

    .setting-item:last-child {
        border-bottom: none;
    }

    .setting-info {
        flex: 1;
    }

    .setting-info h3 {
        font-size: 16px;
        font-weight: 500;
        color: #333;
        margin: 0 0 5px 0;
    }

    .setting-info p {
        font-size: 14px;
        color: #666;
        margin: 0;
    }

    .setting-value {
        font-size: 14px;
        color: #667eea;
        font-weight: 500;
        background: #f8f9ff;
        padding: 8px 15px;
        border-radius: 8px;
    }

    .setting-value.badge {
        padding: 8px 15px;
    }

    .btn-action {
        padding: 8px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s ease;
    }

    .btn-primary-custom {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
    }

    .btn-primary-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        color: white;
    }

    .btn-secondary-custom {
        background: #f8f9fa;
        color: #333;
        border: 1px solid #e0e0e0;
    }

    .btn-secondary-custom:hover {
        background: #e9ecef;
        color: #333;
    }

    .alert-custom {
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        border: none;
    }

    .alert-info-custom {
        background: #e7f3ff;
        color: #0066cc;
    }

    .alert-warning-custom {
        background: #fff3cd;
        color: #856404;
    }

    .config-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .config-box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        border-right: 4px solid #667eea;
    }

    .config-box h4 {
        font-size: 14px;
        color: #666;
        margin: 0 0 5px 0;
        font-weight: 400;
    }

    .config-box p {
        font-size: 18px;
        color: #333;
        margin: 0;
        font-weight: 600;
    }

    .icon-badge {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        margin-left: 15px;
    }

    .icon-badge.purple {
        background: #f0ebff;
        color: #667eea;
    }

    .icon-badge.green {
        background: #e8f5e9;
        color: #4caf50;
    }

    .icon-badge.orange {
        background: #fff3e0;
        color: #ff9800;
    }

    .icon-badge.red {
        background: #ffebee;
        color: #f44336;
    }
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <div class="settings-header">
        <h1><i class="fas fa-cog ms-2"></i> إعدادات النظام</h1>
        <p>إدارة إعدادات وتكوينات منصة AiaY</p>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
                {% endfor %}
                {% endif %}

                <!-- System Information -->
                <div class="settings-card">
        <h2><i class="fas fa-info-circle ms-2"></i> معلومات النظام</h2>

        <div class="setting-item">
            <div class="setting-info">
                <h3>اسم التطبيق</h3>
                <p>اسم المنصة الحالي</p>
            </div>
            <div class="setting-value">AiaY</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>النطاق</h3>
                <p>عنوان URL للموقع</p>
            </div>
            <div class="setting-value">{{ site_url }}</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>البريد الإلكتروني للدعم</h3>
                <p>بريد الاتصال الرئيسي</p>
            </div>
            <div class="setting-value">{{ support_email }}</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>المنطقة الزمنية</h3>
                <p>المنطقة الزمنية للنظام</p>
            </div>
            <div class="setting-value">{{ timezone }}</div>
        </div>
    </div>

    <!-- Configuration Settings -->
    <div class="settings-card">
        <h2><i class="fas fa-sliders-h ms-2"></i> الإعدادات الديناميكية</h2>

        <div class="alert-info-custom">
            <i class="fas fa-lightbulb ms-2"></i>
            يمكنك تعديل هذه الإعدادات من لوحة Django Constance
        </div>

        <div class="config-grid">
            <div class="config-box">
                <h4>SendGrid API Key</h4>
                <p>{{ sendgrid_configured|yesno:"✓ مُفعّل,✗ غير مُفعّل" }}</p>
            </div>

            <div class="config-box">
                <h4>بريد المُرسل</h4>
                <p>{{ email_from_address|default:"غير محدد" }}</p>
            </div>

            <div class="config-box">
                <h4>اسم المُرسل</h4>
                <p>{{ email_from_name|default:"غير محدد" }}</p>
            </div>

            <div class="config-box">
                <h4>OpenAI API Key</h4>
                <p>{{ openai_configured|yesno:"✓ مُفعّل,✗ غير مُفعّل" }}</p>
            </div>
        </div>

        <div style="margin-top: 20px;">
            <a href="/admin/constance/config/" class="btn-action btn-primary-custom" target="_blank">
                <i class="fas fa-edit ms-2"></i>
                تعديل الإعدادات الديناميكية
            </a>
        </div>
    </div>

    <!-- Database & Cache -->
    <div class="settings-card">
        <h2><i class="fas fa-database ms-2"></i> قاعدة البيانات والتخزين المؤقت</h2>

        <div class="setting-item">
            <div class="setting-info">
                <h3>قاعدة البيانات</h3>
                <p>نوع قاعدة البيانات المستخدمة</p>
            </div>
            <div class="setting-value">{{ db_engine }}</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>التخزين المؤقت (Cache)</h3>
                <p>نظام التخزين المؤقت</p>
            </div>
            <div class="setting-value">{{ cache_backend }}</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>البيئة</h3>
                <p>بيئة التشغيل الحالية</p>
            </div>
            <div class="setting-value badge bg-{{ debug|yesno:'warning,success' }}">
                {{ debug|yesno:"Development,Production" }}
            </div>
        </div>
    </div>

    <!-- Email Settings -->
    <div class="settings-card">
        <h2><i class="fas fa-envelope ms-2"></i> إعدادات البريد الإلكتروني</h2>

        <div class="setting-item">
            <div class="setting-info">
                <h3>خادم البريد</h3>
                <p>SMTP Host المستخدم</p>
            </div>
            <div class="setting-value">{{ email_host }}</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>منفذ SMTP</h3>
                <p>رقم المنفذ</p>
            </div>
            <div class="setting-value">{{ email_port }}</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>TLS مُفعّل</h3>
                <p>استخدام التشفير</p>
            </div>
            <div class="setting-value">{{ email_use_tls|yesno:"نعم,لا" }}</div>
        </div>

        <div style="margin-top: 20px;">
            <a href="/admin/constance/config/" class="btn-action btn-secondary-custom" target="_blank">
                <i class="fas fa-cog ms-2"></i>
                تكوين البريد الإلكتروني
            </a>
        </div>
    </div>

    <!-- Payment Integration -->
    <div class="settings-card">
        <h2><i class="fas fa-credit-card ms-2"></i> بوابة الدفع</h2>

        <div class="setting-item">
            <div class="setting-info">
                <h3>مزود الدفع</h3>
                <p>بوابة الدفع المستخدمة</p>
            </div>
            <div class="setting-value">Tap Payment Gateway</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>حالة API</h3>
                <p>اتصال بوابة الدفع</p>
            </div>
            <div class="setting-value badge bg-{{ tap_configured|yesno:'success,danger' }}">
                {{ tap_configured|yesno:"متصل,غير متصل" }}
            </div>
        </div>

        <div class="alert-warning-custom" style="margin-top: 20px;">
            <i class="fas fa-exclamation-triangle ms-2"></i>
            <strong>تنبيه:</strong> مفاتيح API يتم تكوينها عبر متغيرات البيئة فقط
        </div>
    </div>

    <!-- Security Settings -->
    <div class="settings-card">
        <h2><i class="fas fa-shield-alt ms-2"></i> إعدادات الأمان</h2>

        <div class="setting-item">
            <div class="setting-info">
                <h3>HTTPS إجباري</h3>
                <p>إعادة التوجيه إلى HTTPS</p>
            </div>
            <div class="setting-value">{{ secure_ssl_redirect|yesno:"مُفعّل,مُعطّل" }}</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>HSTS Enabled</h3>
                <p>HTTP Strict Transport Security</p>
            </div>
            <div class="setting-value">{{ hsts_enabled|yesno:"مُفعّل,مُعطّل" }}</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>Secure Cookies</h3>
                <p>ملفات تعريف ارتباط آمنة</p>
            </div>
            <div class="setting-value">{{ secure_cookies|yesno:"مُفعّل,مُعطّل" }}</div>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <h3>CORS مُفعّل</h3>
                <p>Cross-Origin Resource Sharing</p>
            </div>
            <div class="setting-value">{{ cors_enabled|yesno:"مُفعّل,مُعطّل" }}</div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="settings-card">
        <h2><i class="fas fa-bolt ms-2"></i> إجراءات سريعة</h2>

        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <a href="/admin/" class="btn-action btn-primary-custom" target="_blank">
                <i class="fas fa-user-shield ms-2"></i>
                لوحة Django Admin
            </a>

            <a href="/admin/api/" class="btn-action btn-secondary-custom" target="_blank">
                <i class="fas fa-database ms-2"></i>
                إدارة البيانات
            </a>

            <a href="/admin/auth/user/" class="btn-action btn-secondary-custom" target="_blank">
                <i class="fas fa-users-cog ms-2"></i>
                إدارة المستخدمين
            </a>

            <a href="/swagger/" class="btn-action btn-secondary-custom" target="_blank">
                <i class="fas fa-book ms-2"></i>
                API Documentation
            </a>
        </div>
    </div>

    <!-- System Status -->
    <div class="settings-card">
        <h2><i class="fas fa-heartbeat ms-2"></i> حالة النظام</h2>

        <div class="config-grid">
            <div class="config-box">
                <div class="d-flex align-items-center">
                    <div class="icon-badge purple">
                        <i class="fas fa-server"></i>
                    </div>
                    <div>
                        <h4>الخادم</h4>
                        <p style="color: #4caf50;">✓ يعمل</p>
                    </div>
                </div>
            </div>

            <div class="config-box">
                <div class="d-flex align-items-center">
                    <div class="icon-badge green">
                        <i class="fas fa-database"></i>
                    </div>
                    <div>
                        <h4>قاعدة البيانات</h4>
                        <p style="color: #4caf50;">✓ متصلة</p>
                    </div>
                </div>
            </div>

            <div class="config-box">
                <div class="d-flex align-items-center">
                    <div class="icon-badge orange">
                        <i class="fas fa-hdd"></i>
                    </div>
                    <div>
                        <h4>التخزين المؤقت</h4>
                        <p style="color: #4caf50;">✓ نشط</p>
                    </div>
                </div>
            </div>

            <div class="config-box">
                <div class="d-flex align-items-center">
                    <div class="icon-badge red">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <h4>OpenAI API</h4>
                        <p style="color: {{ openai_configured|yesno:'#4caf50,#f44336' }};">
                            {{ openai_configured|yesno:"✓ متصل,✗ غير متصل" }}
                        </p>
                    </div>
                </div>
            </div>
            </div>
        </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
